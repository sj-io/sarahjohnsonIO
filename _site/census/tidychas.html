<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sarah Johnson">
<meta name="dcterms.date" content="2024-02-05">
<meta name="description" content="A package to access full CHAS data in a tidy format.">

<title>SJ - Introducing the tidychas R package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../blueshell.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>


</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">SJ</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../housing.html"> 
<span class="menu-text">Housing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../r.html"> 
<span class="menu-text">R Analysis</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sj-io"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/sj-io"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://sarah.fyi/"> <i class="bi bi-controller" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#challenges" id="toc-challenges" class="nav-link" data-scroll-target="#challenges">Challenges</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#cache" id="toc-cache" class="nav-link" data-scroll-target="#cache">Cache</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  </ul></li>
  <li><a href="#future-plans" id="toc-future-plans" class="nav-link" data-scroll-target="#future-plans">Future plans</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introducing the <code>tidychas</code> R package</h1>
</div>

<div>
  <div class="description">
    A package to access full CHAS data in a tidy format.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://sarahjohnson.io">Sarah Johnson</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="summary" class="level1">
<h1>Summary</h1>
<p>CHAS (Comprehensive Housing Affordability Strategy) data are custom tabulations of ACS data created to show housing need. The data, released annually by HUD, is used by local governments to estimate how many households in their jurisdiction qualify for assistance. The <a href="https://github.com/sj-io/tidychas"><code>tidychas</code></a> package allows users full access to CHAS data in a tidy format.</p>
<p>The package has not been submitted to CRAN; to install it, run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("devtools")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"sj-io/tidychas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load the package into your library to use it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidychas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get CHAS data by requesting a geography. You can also specify a year (defaults to 2020), state, and county using FIPS codes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tn <span class="ot">&lt;-</span> <span class="fu">get_chas</span>(<span class="st">"state"</span>, <span class="at">state =</span> <span class="st">"47"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tn <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(st, cnty)) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">6</span>) <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 27%">
<col style="width: 26%">
<col style="width: 4%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: right;">geography</th>
<th style="text-align: right;">geoid</th>
<th style="text-align: left;">name</th>
<th style="text-align: left;">variable</th>
<th style="text-align: left;">universe</th>
<th style="text-align: left;">label</th>
<th style="text-align: left;">concept</th>
<th style="text-align: right;">est</th>
<th style="text-align: right;">moe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">47</td>
<td style="text-align: left;">Tennessee</td>
<td style="text-align: left;">T1_1</td>
<td style="text-align: left;">Occupied housing units</td>
<td style="text-align: left;">All</td>
<td style="text-align: left;">Total</td>
<td style="text-align: right;">2639455</td>
<td style="text-align: right;">6787</td>
</tr>
<tr class="even">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">47</td>
<td style="text-align: left;">Tennessee</td>
<td style="text-align: left;">T1_2</td>
<td style="text-align: left;">Owners</td>
<td style="text-align: left;">All</td>
<td style="text-align: left;">Total</td>
<td style="text-align: right;">1756535</td>
<td style="text-align: right;">10833</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">47</td>
<td style="text-align: left;">Tennessee</td>
<td style="text-align: left;">T1_3</td>
<td style="text-align: left;">Owners</td>
<td style="text-align: left;">1 or more housing problems</td>
<td style="text-align: left;">Housing Problems</td>
<td style="text-align: right;">313750</td>
<td style="text-align: right;">4887</td>
</tr>
<tr class="even">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">47</td>
<td style="text-align: left;">Tennessee</td>
<td style="text-align: left;">T1_4</td>
<td style="text-align: left;">Owners</td>
<td style="text-align: left;">1 or more housing problems!!0-30% HAMFI</td>
<td style="text-align: left;">Housing Problems by Household Income</td>
<td style="text-align: right;">88340</td>
<td style="text-align: right;">2492</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">47</td>
<td style="text-align: left;">Tennessee</td>
<td style="text-align: left;">T1_5</td>
<td style="text-align: left;">Owners</td>
<td style="text-align: left;">1 or more housing problems!!0-30% HAMFI!!White</td>
<td style="text-align: left;">Housing Problems by Household Income by Race</td>
<td style="text-align: right;">67510</td>
<td style="text-align: right;">2063</td>
</tr>
<tr class="even">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">47</td>
<td style="text-align: left;">Tennessee</td>
<td style="text-align: left;">T1_6</td>
<td style="text-align: left;">Owners</td>
<td style="text-align: left;">1 or more housing problems!!0-30% HAMFI!!Black</td>
<td style="text-align: left;">Housing Problems by Household Income by Race</td>
<td style="text-align: right;">14935</td>
<td style="text-align: right;">1088</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<p>When interned at my local county’s Department of Housing in 2018, one of my assignments was to help fill in the tables required for our 5-Year Consolidated Plan (ConPlan). The data used for the ConPlan is <a href="https://www.huduser.gov/portal/datasets/cp.html#data_2006-2020">exclusively available through HUD</a>, called the CHAS dataset. It contains special enumerations of Census data not available through typical ACS datasets.</p>
<p>I discovered R and the <code>tidycensus</code> package during that semester, and I recall my frustration that there wasn’t a package that made accessing CHAS data as easy as the <code>tidycensus</code> package for ACS data. While there is a query tool on the CHAS webpage, it only offers summaries of the data and omits details that are required for the ConPlan. Additionally, because I work in an urban county jurisdiction, I had to calculate estimates for all value by subtracting the City of Memphis from the overall Shelby County data. More detailed data provided by IDIS or CPD Maps is outdated compared to the data available.</p>
<p>Five years later and I am back in the Department of Housing and tasked with the same assignment of filling in data for our ConPlan. I have greatly expanded my R knowledge over this period, and began dipping my toe into package creation last year with my <a href="https://github.com/sj-io/mk8dx"><code>mk8dx</code></a> package to convert Mario Kart 8 Deluxe speedrunning data from <code>.lss</code> files to datatables. I figured a package for accessing CHAS data would be a useful project since ConPlans are required from jurisdictions across the country.</p>
</section>
<section id="challenges" class="level1">
<h1>Challenges</h1>
<p>I couldn’t simply clone the <code>tidycensus</code> package and adapt it for CHAS data due to some challenges that arose during development:</p>
<ul>
<li><strong>CHAS data is not fully available through an API.</strong> HUD offers <a href="https://www.huduser.gov/portal/dataset/chas-api.html">an API for CHAS data</a> (which can be accessed through the <code>hudr</code> package), but it only contains summary data found on the CHAS query tool website. I also found the data dictionary on the API site to be broken, so I had no idea what data variables provided. <strong>Downloading zip files from the CHAS website is the only way to download full datasets.</strong></li>
<li><strong>CHAS data is not in a tidy format.</strong> Unzipping a CHAS data file reveals 24 files labelled “Table1.csv” to “Table18C.csv”. Data required for one ConPlan table may be spread across multiple CHAS tables. Each geography has one row per table and values are entered under column names formatted like “T1_est1” and “T18C_moe1”. To decipher the values, there is an excel file containing a data dictionary listing descriptions for all variables. <strong>tidychas pivots data into a tidy format and joins it with the data dictionary.</strong></li>
<li><strong>Descriptions are inconsistent across variables</strong>; such as “other household type (non-elderly non-family)” in Table 7 or “AND household type is non-family non-elderly” in Table 16. These descriptions are divided up into simple columns of “Description 1” to “Description 5”. <strong>tidychas standardizes variable labels and concepts.</strong></li>
<li><strong>Tidying data can require massive amounts of memory.</strong> The 2020 unzipped tract data folder contains 1.26 GB of csv files, and it takes a lot of memory to read, filter, pivot, and join the table. <strong>tidychas uses <code>arrow</code> to ease memory strain.</strong> While initial data requests might still use a large amount of memory, the data is cached and requires significantly less memory in the future.</li>
</ul>
</section>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>The <code>tidychas</code> package currently has one exported function: <a href="https://github.com/sj-io/tidychas/blob/main/R/get_chas.R"><code>get_chas()</code></a>.</p>
<p><code>get_chas(geography, year = NULL, state = NULL, county = NULL, keep_zip = TRUE)</code></p>
<ul>
<li><p>Users can search for the following <code>geography</code>:</p>
<ul>
<li>“state”</li>
<li>“county”</li>
<li>“tract”: Census tracts</li>
<li>“place”: Census places (cannot narrow by county)</li>
<li>“counties by place”: Places in counties. When I searched for “Memphis”, the data in this geography was the same as from “places”, with the bonus of being able to subset by county beforehand (for less memory strain).</li>
<li>“mcd”: Minor civil divisions (such as county commission districts for Shelby County, TN)</li>
<li>“consolidated cities”: Consolidated city-county governments, such as Nashville-Davidson county.</li>
</ul></li>
</ul>
<p>There is also a “remainders” geography available from HUD, but this geography is not readily split by “state” or “county” so it requires a massive amount of memory to tidy. As such, this geography is disabled until I develop a better way to tidy the data.</p>
<ul>
<li>If no year is specified, the most current year is used (2020 as of this posting).</li>
<li>Users can also filter by “state” or “county” when the geography allows.</li>
<li>By default, <code>tidychas</code> keeps the zip file downloaded from the HUD website to easily access it for future use. These files take up additional space in the cache, ranging from a few hundred kilobytes to a few hundred megabytes. You can choose to delete the file after use with <code>keep_zip = FALSE</code>.</li>
</ul>
<section id="cache" class="level2">
<h2 class="anchored" data-anchor-id="cache">Cache</h2>
<p><code>tidychas</code> uses the <code>rappdirs</code> package to locate the default cache folder of the system you’re using. For instance, the cache will be located:</p>
<ul>
<li>macos: <code>/Users/{user}/Library/Caches/tidychas/</code></li>
<li>Windows: <code>\Users\{user}\AppData\Local\tidychas\</code>.</li>
</ul>
<p>If the requested data is not already in the cache, the package will download the relevant zip file from HUD’s website. A temporary directory is created to store the unzipped files, which is deleted after use.</p>
<p>My initial attempts to tidy the data took far too much memory, so I used the <code>arrow</code> package, which is better at managing memory and significantly faster than packages such as <code>readr</code>. Each csv file is opened as an arrow table, narrowed for the requested geography, and saved in the temporary directory. Then each csv file is reopened, pivoted to a tidy format, and rows for each table are binded together into one table. I found this method of opening, narrowing, saving, reopening, tidying, and binding to be much less burdensome on memory than skipping saving and reopening the files, particularly for smaller geographies.</p>
<p>The tidied data is then stored in the cache as a dataset easily useable by arrow. Arrow can simultaneously partion data while saving it, breaking the file into smaller chunks more easily read in the future. The data is partitioned by <code>year</code> and <code>geography</code>, and there is currently a cap of one million rows per csv file. If there is already a file with the specified year and geography, the new data is binded to the existing data before saving.</p>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">Variables</h2>
<p>The package creates a csv of variables for the given year (if one hasn’t been created) using the data dictionary provided in the unzipped folder. The variables are standardized using a lookup table within the package, which also assigns a concept to each variable. For instance, “AND household income is greater than 40% but less than or equal to 50% of HAMFI” is converted to “40-50% HAMFI” and the concept will be “Household Income”.</p>
<p>Rather than variables being in columns labeled “Description_1” to “Description_5”, the “Description_1” column is relabeled to <code>universe</code>, referring to the overall category the data belongs to. The universe will be one of the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(tn<span class="sc">$</span>universe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Occupied housing units"  "Owners"                 
[3] "Renters"                 "Vacant-for-sale"        
[5] "Vacant-for-rent"         "Owners with mortgage"   
[7] "Owners with no mortgage"</code></pre>
</div>
</div>
<p>Elements in “Description_2” to “Description_5” are united together into one <code>label</code> column, with each element separated by “!!”. The <code>concept</code> assigned to each variable are also united together into one table and separated with ” by ” (such as “Housing Problems by Household Income by Race”). This was done to match the formatting of variables from the <code>tidycensus</code> package.</p>
<p>There is one minor annoyance with the <code>tidycensus</code> package I wanted to address with this package. With <code>tidycensus</code>, you must first use <code>load_variables()</code> to find the table/variables you wish to call, and then <code>get_acs(..., variables = "XXXXXXXX")</code> to get the data. If you want to see the default variable labels next to the data, you have to join these tables. However, the column name for variables is <code>name</code> from the <code>load_variables()</code> function and <code>variable</code> from the <code>get_acs()</code> function, and <code>get_acs()</code> also returns a <code>NAME</code> column containing the name of the requested geography, which I’ve found confusing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>v21 <span class="ot">&lt;-</span> <span class="fu">load_variables</span>(<span class="dv">2021</span>, <span class="st">"acs5"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="st">"state"</span>, <span class="at">variables =</span> <span class="st">"B01001A_029"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>joined <span class="ot">&lt;-</span> example <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(v21 <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>geography), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"variable"</span> <span class="ot">=</span> <span class="st">"name"</span>)) <span class="sc">|&gt;</span> <span class="fu">relocate</span>(<span class="fu">c</span>(estimate, moe), <span class="at">.after =</span> <span class="st">"concept"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>joined <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">4</span>) <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 38%">
<col style="width: 23%">
<col style="width: 8%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">GEOID</th>
<th style="text-align: left;">NAME</th>
<th style="text-align: left;">variable</th>
<th style="text-align: left;">label</th>
<th style="text-align: left;">concept</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">moe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: left;">B01001A_029</td>
<td style="text-align: left;">Estimate!!Total:!!Female:!!65 to 74 years</td>
<td style="text-align: left;">SEX BY AGE (WHITE ALONE)</td>
<td style="text-align: right;">202185</td>
<td style="text-align: right;">591</td>
</tr>
<tr class="even">
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: left;">B01001A_029</td>
<td style="text-align: left;">Estimate!!Total:!!Female:!!65 to 74 years</td>
<td style="text-align: left;">SEX BY AGE (WHITE ALONE)</td>
<td style="text-align: right;">21447</td>
<td style="text-align: right;">201</td>
</tr>
<tr class="odd">
<td style="text-align: left;">04</td>
<td style="text-align: left;">Arizona</td>
<td style="text-align: left;">B01001A_029</td>
<td style="text-align: left;">Estimate!!Total:!!Female:!!65 to 74 years</td>
<td style="text-align: left;">SEX BY AGE (WHITE ALONE)</td>
<td style="text-align: right;">323192</td>
<td style="text-align: right;">1049</td>
</tr>
<tr class="even">
<td style="text-align: left;">05</td>
<td style="text-align: left;">Arkansas</td>
<td style="text-align: left;">B01001A_029</td>
<td style="text-align: left;">Estimate!!Total:!!Female:!!65 to 74 years</td>
<td style="text-align: left;">SEX BY AGE (WHITE ALONE)</td>
<td style="text-align: right;">132389</td>
<td style="text-align: right;">444</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>For <code>tidychas</code>, variable codes are always in the <code>variable</code> column, and <code>name</code> is always used for the name of the geography. Additionally, tables are always returned with the variable labels joined to the variables.</p>
</section>
</section>
<section id="future-plans" class="level1">
<h1>Future plans</h1>
<ul>
<li>Allow users to call specific tables/variables. Currently the package pulls all variables for a specific geography. I did this partly because CHAS data required for the ConPlan is spread across multiple tables, and it is easier for me to figure out which variables I need by getting all the data. In the future I want a system similar to <code>tidycensus</code> where users can call for a specific table or variable.</li>
<li>Have a FIPS code reference to allow easier filtering for geographies, in the same method as <code>tidycensus</code>. As the package stands, you have to know the FIPS code for the state and/or county for which you want to request data. Instead, I want to allow people to be able to enter state data like “TN” for Tennessee, instead of “47”.</li>
<li>Correct label tidying for years prior to 2018. The labels I tidied work for 2018-2020 data, but prior years still need to be cleaned. Currently, labels that are missed by tidying are still output, but they don’t match the formatting of more recent datasets.</li>
<li>Allow users to keep default CHAS labels. While I ensure the shortened labels accurately reflect the original CHAS labels, I want to give users the options to keep the default rather than being forced to use my relabeling.</li>
<li>Possibly switch cache data from csv to parquet files. I originally used parquet files in the cache; however, parquet files are generally not recommended for files smaller than 200MB. I noticed most cached data was smaller than this limit, and in testing csv files were quicker to process at this size than parquet. However, smaller geographies such as tracts can exceed the 200MB limit and might benefit from being saved as parquet files rather than csv.</li>
<li>Create a package to generate ConPlan tables from CHAS data. This will allow local governments to easily update their ConPlan with the most recent CHAS data without wrangling the data.</li>
</ul>
<p>To keep up with issues and enhancements to the package, check out the <a href="https://github.com/sj-io/tidychas">github repo</a>, specifically the <a href="https://github.com/sj-io/tidychas/issues">issues</a> tab.</p>


</section>

<script data-goatcounter="https://sarahjohnson.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{johnson2024,
  author = {Johnson, Sarah},
  title = {Introducing the `Tidychas` {R} Package},
  date = {2024-02-05},
  url = {https://sarahjohnson.io/census/tidychas.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Johnson, Sarah. 2024. <span>“Introducing the `Tidychas` R
Package.”</span> February 5, 2024. <a href="https://sarahjohnson.io/census/tidychas.html">https://sarahjohnson.io/census/tidychas.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>